import os
import platform
from command import Command
from processOutputs import processLinux, processWindows, processPIP

def getPIPFreeze():
    if platform.system() == 'Windows':
        cmd = ["powershell.exe"]
    elif platform.system() == 'Linux':
        cmd = ["sh", "-c"]
    else:
        print("The OS %s is not supported!" % platform.system())
        exit(-1)
    cmd.append("pip freeze")
    command = Command(cmd, '.')
    output = command.run(timeout=5)
    #print(output[0])
    #print(output[-1])
    return processPIP(output)
    
def getInstalledProgram():
    print("Your OS is %s" % platform.system())
    if platform.system() == 'Windows':
        cmd = ["powershell.exe", ""]
        command = Command(cmd, '.')
        output = command.run(timeout=5)
        #TODO
    elif platform.system() == 'Linux':
        cmd = ["sh", "-c", "dpkg -l"]
        command = Command(cmd, '.')
        output = command.run(timeout=5)
        output = output[5:]#cut dpkg explains and table head
        output = processLinux(output)
        #print(output[0])
        #print(output[-1])
    else:
        print("The OS %s is not supported!" % platform.system())
        exit()
    return output

if __name__ == "__main__":
    pipEntries = getPIPFreeze()
    print(pipEntries[0], pipEntries[-1])
    installedEntries = getInstalledProgram()
    print(installedEntries[0], installedEntries[-1])
